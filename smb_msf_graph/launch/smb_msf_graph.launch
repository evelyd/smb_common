<?xml version="1.0" encoding="UTF-8"?> 
<launch>

    <!-- Parameters -->
    <arg name="use_sim_time"                value="false" />
    <arg name="launch_o3d_slam"             default="true" />
    <arg name="lidar_odometry_topic_name"   default="/mapping_node/scan2map_odometry"/>
    
    <!-- Arguments -->

    <arg name="cloud_topic"           default="/rslidar/points" doc="input topic for the lidar pointcloud"/>
    <arg name="parameter_filename"    default="param_robosense_rs16.lua" doc="param file name"/>
	<arg name="parameter_folder_path" default="$(find smb_slam)/config/open3d_slam/" doc="directory for the parameter files"/>
    <arg name="launch_rviz"           default="false" doc="whether to launch rviz"/>
    <arg name="launch_sensors"        default="false" doc="whether to launch the sensors on the robot"/>
    <arg name="map_saving_folder"     default="$(find smb_slam)/data/maps/" doc="Path for saving the map"/>
    <arg name="loop_closure"          default="true"  doc="Loop closure"/>

    <arg name="core_graph_config_param_file"  default="$(find smb_estimator_graph)/config/core/core_graph_config.yaml"/>
    <arg name="core_graph_param_file"         default="$(find smb_estimator_graph)/config/core/core_graph_params.yaml"/>
    <arg name="core_extrinsic_param_file"     default="$(find smb_estimator_graph)/config/core/core_extrinsic_params.yaml"/>
    <arg name="smb_graph_param_file"          default="$(find smb_estimator_graph)/config/smb_specific/smb_graph_params.yaml"/>
    <arg name="smb_extrinsic_param_file"      default="$(find smb_estimator_graph)/config/smb_specific/smb_extrinsic_params.yaml"/>

    <arg name="pcd_file_path"         default="$(find smb_challenge)/data/maps/map.pcd"/>

    <!-- Alias to smb_estimator_graph replay script -->
    <include file="$(find smb_estimator_graph)/launch/smb_estimator_graph.launch">
        <arg name="core_graph_config_param_file"  value="$(arg core_graph_config_param_file)"/>
        <arg name="core_graph_param_file"         default="$(arg core_graph_param_file)"/>
        <arg name="core_extrinsic_param_file"     default="$(arg core_extrinsic_param_file)"/>
        <arg name="smb_graph_param_file"          default="$(arg smb_graph_param_file)"/>
        <arg name="smb_extrinsic_param_file"      default="$(arg smb_extrinsic_param_file)"/>
    </include>

    <group if="$(arg launch_o3d_slam)">
        <!-- Launch online_slam -->
        <include file="$(find smb_slam)/launch/online_slam.launch">
            <arg name="pcd_file_path"         value="$(arg pcd_file_path)"/>
            <arg name="use_sim_time" value="$(arg use_sim_time)" />
            <arg name="cloud_topic" value="$(arg cloud_topic)" />
            <arg name="parameter_filename" value="$(arg parameter_filename)" />
            <arg name="parameter_folder_path" value="$(arg parameter_folder_path)" />
            <arg name="launch_rviz" value="$(arg launch_rviz)" />
            <arg name="launch_sensors" value="$(arg launch_sensors)" />
            <arg name="map_saving_folder" value="$(arg map_saving_folder)" />
            <arg name="loop_closure" value="$(arg loop_closure)"/>
        </include>
    </group>

</launch>
